<dom-module id="tei-output-rendition">
    <template>
        <style is="custom-style">
            .addIcon {
                --iron-icon-fill-color: var(--paper-pink-500);
                position: absolute;
                display: inline-block;
                right: 12px;
                top: 2px;
            }
        </style>

        <style include="publisher-styles">
            :host {
                display: inline-block;
            }

            .cell {
                display: table-cell;
                padding: 10px;
                vertical-align: bottom;
            }

            [icon="add"] {
                position: absolute;
                top: 4px;
                right: 10px;
            }

        </style>

        <!--<div class="wrapper">-->
        <!--
                    <div class="header">
                        <span class="label">Output Renditions</span>
                        <span class="actions">
                            <paper-icon-button class="addIcon" icon="add-circle" on-click="_addEntry"></paper-icon-button>
                        </span>
                    </div>
        -->

        <div class="wrapper">
            <paper-dropdown-menu id="scope" class="cell" label="scope" noink no-animation>
                <paper-listbox slot="dropdown-content" attr-for-selected="item" selected="{{scope}}">
                    <paper-item item=""></paper-item>
                    <paper-item item="before">before</paper-item>
                    <paper-item item="after">after</paper-item>
                </paper-listbox>
            </paper-dropdown-menu>

            <paper-input class="textnode cell" id="text" label="scope" value="{{value}}" title="scope">
                <slot id="slot" name="scope"></slot>
            </paper-input>
            <div class="cell">
                <paper-icon-button icon="remove-circle" on-click="_removeEntry"></paper-icon-button>
            </div>
        </div>


        <!--</div>-->


    </template>
    <script>
        class TeiOutputRendition extends Polymer.Element {
            static get is() {
                return 'tei-output-rendition';
            }

            static get properties() {
                return {
                    scope: {
                        type: String,
                        reflectToAttribute: true
                    },
                    value: {
                        type: String,
                        observer: '_valueChanged',
                        reflectToAttribute: false
                    },

                }
            }

            constructor() {
                super();
                console.log("TeiOutputRendition constructor...")
            }

            connectedCallback() {
                super.connectedCallback();
                console.log("TeiOutputRendition connected");
                this.setAttribute("slot", "output-rendition");
                this.value = this.innerHTML;
            }

            createSlotElements() {
                var slots = this.shadowRoot.querySelectorAll("slot")
                console.log("slots ", slots);
                for (var i = 0, len = slots.length; i < len; i++) {
                    console.log("slot: ", slots[i].assignedNodes());
                    if (slots[i].assignedNodes().length == 0) {
                        var slot = slots[i].name
                        console.log("slot has no content - creating ", slot);
                        var e = document.createElement('tei-' + slot)
                        e.setAttribute("slot", slot)
                        this.appendChild(e);
                    }
                }
            }

            _showEmptySlots(e) {
                this.createSlotElements();
            }

            _setPreferred(e) {
                this.$.star.icon = "star";
            }


            _removeEntry(e) {
                console.log("tei-output-rendition delete");
                this.parentNode.removeChild(this);
            }


            _valueChanged(val) {
                console.log("newVal: ", val);
                this.value = val;
                this.innerHTML = val;
            }

        }

        customElements.define(TeiOutputRendition.is, TeiOutputRendition);
    </script>
</dom-module>
